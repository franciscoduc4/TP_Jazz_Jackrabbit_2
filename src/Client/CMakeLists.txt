set(SDL2PP_WITH_IMAGE ON)
set(SDL2PP_WITH_MIXER ON)
set(SDL2PP_WITH_TTF ON)

# Correct the add_subdirectory command with a unique binary directory
#add_subdirectory(${PROJECT_SOURCE_DIR}/extlibs/libsdl2pp ${CMAKE_BINARY_DIR}/extlibs/libsdl2pp_build)
add_subdirectory(${PROJECT_SOURCE_DIR}/extlibs/libsdl2pp)
# Define project include directories
set(PROJECT_INCLUDE_DIRS
    ${PROJECT_SOURCE_DIR}/src/Client
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby
    ${PROJECT_BINARY_DIR}/src  # For autogenerated headers
    # Add other project-specific include directories here
)

# Gameview library
set(GAMEVIEW_SOURCES
    SDL/enemy.cpp
    SDL/enemy.h
    SDL/enemyweapon.cpp
    SDL/enemyweapon.h
    SDL/gamescreen.cpp
    SDL/gamescreen.h
    SDL/level.cpp
    SDL/level.h
    SDL/player.cpp
    SDL/player.h
    SDL/points.cpp
    SDL/points.h
    SDL/projectile.cpp
    SDL/projectile.h
)

add_library(gameview ${GAMEVIEW_SOURCES})

target_include_directories(gameview PRIVATE ${PROJECT_INCLUDE_DIRS})
target_link_libraries(gameview PUBLIC SDL2pp SDL2_image)
target_compile_definitions(gameview PUBLIC ASSETS_PATH="${VARDIR}/assets/")

# Qt UI components
find_package(QT NAMES Qt5 COMPONENTS Widgets REQUIRED)
include_directories(${PROJECT_SOURCE_DIR}/src/Client/Lobby)
qt5_wrap_ui(UIS_HEADERS
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/characterselection.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/creategame.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/gamelist.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/lobby.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/name_screen.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/sceneselection.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/scenespriteswidget.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/waitingroom.ui
    ${PROJECT_SOURCE_DIR}/src/Client/Lobby/welcome.ui
)

set(CLIENT_RESOURCES ${CMAKE_CURRENT_SOURCE_DIR}/resources.qrc)
qt5_add_resources(CLIENT_RESOURCES_RCC ${CLIENT_RESOURCES})

set(CMAKE_AUTOUIC ON)
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)

# Client executable
file(GLOB_RECURSE CLIENT_SOURCES
    *.cpp
    *.h
    Lobby/*.cpp
    Lobby/*.h
    Lobby/SelectWidgets/*.cpp
    Lobby/SelectWidgets/*.h
    Protocol/*.cpp
    Protocol/*.h
    main.cpp
)

add_executable(jazzclient ${CLIENT_SOURCES} ${UIS_HEADERS} ${CLIENT_RESOURCES_RCC})
target_link_libraries(jazzclient PUBLIC Qt5::Widgets Qt5::Core gameview)
target_link_libraries(jazzclient PUBLIC SDL2 SDL2_image)
target_include_directories(jazzclient PRIVATE ${PROJECT_INCLUDE_DIRS})
set_target_properties(jazzclient PROPERTIES LINK_FLAGS "-lSDL2_image")
